<div class="container-fluid">
    <div class="row">
        <div class="col-md-12 col-sm-12 padding-null tittlediv">
            <div class="flexrow space-between align-center">
                <h3 class="item-heading"> {{ moduleHeading }} </h3>
                <div *ngIf="hideLeftPanel===false">

                    <img style="display: none;" src="../assets/images/grid1.png" (click)="showFullScreen()">
                    <button class="btn  btn-transparent" (click)="addRecord();" (click)="showInvoiceDialog()"
                        *ngIf="hideText&&isApprovalPage==false && newPermission"> New Record</button>
                    <!-- Export Menu Starts Here -->
                    <!-- {{currentPage}} -->

                    <!-- <button class="btn btn-transparent" (clickOutside)="onClickedOutside($event)"
                        [exclude]="'.left-section'" (click)="split()"> {{showfilterstext}} </button> -->


                    <div *ngIf="!showfilters" ngbDropdown placement="bottom-right" style="padding:0px;"
                        class="d-inline-block">
                        <button class="btn customdropdown btn-transparent"
                            style="background:none;border:none;padding:0px;" id="dropdownBasic1" ngbDropdownToggle>
                            <i class="fa-solid fa-bars"></i>
                        </button>

                        <div ngbDropdownMenu aria-labelledby="dropdownBasic1"
                            *ngIf="hideText &&(printPermission || exportPermission)||viewLogPermission  ">
                            <button (click)="ExportAsExcel()"
                                *ngIf="hideText && exportPermission && selectedInvoiceDetails.WorkFlowStatusId == workFlowStatus.Completed"
                                class="dropdown-item">Export</button>
                            <button class="dropdown-item" *ngIf="hideText && printPermission"
                                (click)="onPDFPrint()">Print</button>
                            <button class="dropdown-item" *ngIf="viewLogPermission" (click)="displayLogPopUp()">View
                                Log</button>
                        </div>

                    </div>
                </div>
            </div>
 
            <div class="row">
                
            </div>
            <!-- Filter Form Starts Here -->
            <div class="filter-section" style="width: 100%;" ngbDropdown #myDrop="ngbDropdown">
                <form [formGroup]="sinvFilterInfoForm">
                    <div class="form-group row" style="display: flex; flex-wrap:wrap;justify-content: space-between;">
                        <label class="col-form-label col form-label">PO #</label>
                        <div>
                            <input style="width: 100px;" type="text" #poCode formControlName="PoNumber" class="form-control">
                        </div>
                        <label class="col-form-label col form-label">Supplier</label>
                        <div class=" autoComplete">
                            <input formControlName="SupplierCategory" type="text" style="width:120px;"
                            class="form-control show" [inputFormatter]="supplierInputFormater"
                            [ngbTypeahead]="supplierSearch"
                            (selectItem)="onSupplierFilterChange($event)"
                            [resultTemplate]="supplierTemplate" />
                        </div>
                        <label class="col-form-label  col form-label">From Date</label>

                        <div class="input-group" style="width: auto;">
                            
                            <input style="width: 100px;" class="form-control fromcontrol" formControlName="FromDate" ngbDatepicker
                                #fromDate="ngbDatepicker" [readonly]="true">
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" (click)="fromDate.toggle();toDate.close()" type="button">
                                    <i class="fa fa-calendar" style="cursor: pointer;"></i>
                                </button>
                            </div>
                        </div>
                        <label class="col-form-label col form-label">To Date</label>
                        <div class="  input-group" style="width: auto;">
                            <input style="width: 100px;" class="form-control" formControlName="ToDate" ngbDatepicker
                                #toDate="ngbDatepicker" [readonly]="true">
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" (click)="toDate.toggle();fromDate.close()" type="button">
                                    <i class="fa fa-calendar" style="cursor: pointer;"></i>
                                </button>
                            </div>
                        </div>
            
                        <label class="col-form-label col form-label">PO Type</label>
                        <div class=" ">
                            <select #purchaseOrderDropDown formControlName="PoTypeId" class="form-control">
                                <option value=0>
                                    Select
                                </option>
                                <option *ngFor="let record of purchaseOrderTypes" value={{record.PurchaseOrderTypeId}}>
                                    {{record.PurchaseOrderType}}
                                </option>
                            </select>
                        </div>
                        <label class="col-form-label col form-label">Status</label>
                        <div class=" ">
                             <!--  <select #workFlowStatusDropDown formControlName="WorkFlowStatusId" class="form-control">
                              <option value=0>
                                    Select
                                </option>
                                <option *ngFor="let record of workFlowStatuses" value={{record.WorkFlowStatusid}}>
                                    {{record.Statustext}}
                                </option> 
                            </select>-->
                            <select formControlName="Status" class="form-control">
                                <option value=0>--Select--</option>
                                <option value="Draft">Draft</option>
                                <option value="CancelDraft">Cancel Draft</option>
                                <option value="Completed">Open</option>
                                <option value="Pending Approval">Pending Approval</option>
                                <option value="Return for Clarifications">Return for Clarifications</option>
                                <option value="Cancelled Approval">Cancelled Approval</option>
                                <option value="Voided">Voided</option>
                                <option value="Rejected">Rejected</option>
                                <option value="Exported">Exported</option>
                                <option value="Partially Paid">Partially Paid</option>
                                <option value="Fully Paid">Fully Paid</option>
                            </select>
                        </div>
                        <div class="col_1">
                            <button type="submit" (click)="filterData()" class="btn btn-save">
                                <i class="fa fa-check" ria-hidden="true"></i> Apply</button>
                            <button type="submit" (click)="resetFilters()" class="btn btn-save">
                                <i class="fa fa-refresh" aria-hidden="true"></i> Reset</button>
                        </div>
                    </div>
                    <div style="display: flex; flex-wrap:wrap;justify-content:end">
                        <!-- <div class="error errorMessage" style="position:absolute;left:0 !important;">
                                                {{filterMessage}}
                                            </div> -->
                        <div *ngIf="invoicesList.length==0" style="text-align: right;">
                            {{filterMessage}}
                        </div>
                        <div style="text-align: right;">
                            <!-- {{!HideTable}} -->
                            <!-- {{purchaseOrdersList.length}} -- {{this.sharedServiceObj.PORecordslength}} -- -->
                            Total Records : {{TotalRecords}} &nbsp;
                        </div>
            
                        <button class="btn btn-save ng-star-inserted" type="button" (click)="ClickNewRecord()">
                            <i class="fa fa-plus" ria-hidden="true" aria-hidden="true"></i> New</button>
            
                        <button class="btn btn-save ng-star-inserted" mat-button [matMenuTriggerFor]="ExportMenu">
                            <i class="fa fa-file-export" ria-hidden="true" aria-hidden="true"></i>
                            Export </button>
                        <!-- <mat-menu #beforeMenu="matMenu" xPosition="before"> -->
                        <mat-menu #ExportMenu="matMenu" yPosition="below">
                            <button mat-menu-item (click)="ExportToExcel()">
                                <i class="fa fa-file-excel-o" ria-hidden="true" aria-hidden="true"></i>
                                Excel </button>
                            <button mat-menu-item (click)="ExportToCSV()">
                                <i class="fa fa-file-excel-o" ria-hidden="true" aria-hidden="true"></i> CSV
                            </button>
                            <button mat-menu-item (click)="ExportToPDF()">
                                <i class="fa fa-file-pdf-o" ria-hidden="true" aria-hidden="true"></i> PDF
                            </button>
                        </mat-menu>
            
                        <img style="display: none;" src="../assets/images/grid1.png" (click)="showFullScreen()">
                        <div *ngIf="!showfilters" ngbDropdown placement="bottom-right" style="padding:0px;" class="d-inline-block">
            
                            <div ngbDropdownMenu aria-labelledby="dropdownBasic1"
                                *ngIf="hideText && (printPermission || emailPermission) && (showPrintButton || showEmailButton) || viewLogPermission">
                                <button class="dropdown-item" *ngIf="showPrintButton && printPermission && hideText"
                                    (click)="onPDFPrint()">Print</button>
                                <button class="dropdown-item" *ngIf="showEmailButton && emailPermission && hideText"
                                    (click)="displayEmailPopUp()">Email</button>
                                <button class="dropdown-item" *ngIf="viewLogPermission" (click)="displayLogPopUp()">View
                                    Log</button>
                                <!-- <button class="dropdown-item"  *ngIf="showEmailButton"   (click)="sendMailtoSupplier()">Email</button> -->
                            </div>
                        </div>
            
                        <!-- <div *ngIf="showdilogbox" class="dialogdropdown"> -->
                            <!-- <div *ngIf="showdilogbox" class="dialogdropdown">
                                <select #purchaseOrderDropDown class="form-control" #mySelect (change)='onOptionsSelected(mySelect.value)'>
                                    <option *ngFor="let record of purchaseOrderTypes" value={{record.PurchaseOrderTypeId}}>
                                        {{record.PurchaseOrderType}}
                                    </option>
                                </select>
                            </div> -->
                    </div>
                </form>
            </div>
            <!-- Filter Form Ends Here -->

            <!-- <div class="row">
                <div class="col-md-12 col-sm-12 padding-null tittlediv" style="height:60px;padding:12px;">
                    <p>Filter Here</p>
                </div>
            </div> -->
            <div class="left-section1" *ngIf="hideLeftPanel===false" [class.display-filters]="!showfilters">
                <div class="filter-section" ngbDropdown #myDrop="ngbDropdown">
                    <!-- start filter code -->
                    <!-- <div class="flexrow space-between">
                        <div class="left-search">
                            <input type="text" [(ngModel)]="InvoiceSearchKey" placeholder="Search requests..."
                                (keyup)="onSearchInputChange($event)" class="search-filter">
                            <i class="fa fa-search" aria-hidden="true"></i>
                            <div class="filter-popup" *ngIf="initDone" ngbDropdownMenu aria-labelledby="dropdownManual"
                                (click)="$event.stopPropagation(); myDrop.open();">

                                <form [formGroup]="sinvFilterInfoForm" class="form-horizontal">

                                    <div class="form-group row">
                                        <label class="col-form-label col-6 form-label">Invoice Code</label>
                                        <div class="col-6">

                                            <input type="text" #sinvCode formControlName="SInvCode"
                                                class="form-control">

                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <label class="col-form-label col-6 form-label">Supplier</label>
                                        <div class="col-6 autoComplete">
                                  
                                            <input formControlName="SupplierCategory" type="text"
                                                class="form-control show" [inputFormatter]="supplierInputFormater"
                                                [ngbTypeahead]="supplierSearch"
                                                (selectItem)="onSupplierFilterChange($event)"
                                                [resultTemplate]="supplierTemplate" />
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-form-label  col-xl-4 col-lg-4 col-sm-6 col-6 form-label">From
                                            Date</label>
                                        <div class="col-xl-8 col-lg-8 col-sm-6 col-6 input-group">
                                            <input class="form-control" formControlName="FromDate" ngbDatepicker
                                                #fromDate="ngbDatepicker">
                                            <div class="input-group-append">
                                                <button class="btn btn-outline-secondary" (click)="fromDate.toggle()"
                                                    type="button">
                                                    <i class="fa fa-calendar" style="cursor: pointer;"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-form-label col-xl-4 col-lg-4 col-sm-6 col-6 form-label">To
                                            Date</label>
                                        <div class="col-xl-8 col-lg-8 col-sm-6 col-6 input-group">
                                            <input class="form-control" formControlName="ToDate" ngbDatepicker
                                                #toDate="ngbDatepicker">
                                            <div class="input-group-append">
                                                <button class="btn btn-outline-secondary" (click)="toDate.toggle()"
                                                    type="button">
                                                    <i class="fa fa-calendar" style="cursor: pointer;"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <label class="col-form-label col-6 form-label">PO Type</label>
                                        <div class="col-6">
                                            <select #purchaseOrderDropDown formControlName="PoTypeId"
                                                class="form-control">
                                                <option value=0>
                                                    --Select--
                                                </option>
                                                <option *ngFor="let record of purchaseOrderTypes"
                                                    value={{record.PurchaseOrderTypeId}}>
                                                    {{record.PurchaseOrderType}}
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-form-label col-6 form-label">Status</label>
                                        <div class="col-6">
                                            <select formControlName="Status" class="form-control">
                                                <option value=0>--Select--</option>
                                                <option value="Draft">Draft</option>
                                                <option value="CancelDraft">Cancel Draft</option>
                                                <option value="Completed">Open</option>
                                                <option value="Pending Approval">Pending Approval</option>
                                                <option value="Return for Clarifications">Return for Clarifications
                                                </option>
                                                <option value="Cancelled Approval">Cancelled Approval</option>
                                                <option value="Voided">Voided</option>
                                                <option value="Rejected">Rejected</option>
                                                <option value="Exported">Exported</option>
                                                <option value="Partially Paid">Partially Paid</option>
                                                <option value="Fully Paid">Fully Paid</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-form-label col-6 form-label">PO Number</label>
                                        <div class="col-6">
                                            <input type="text" formControlName="PoNumber" class="form-control">
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <div class="col-12 error">
                                            {{filterMessage}}
                                        </div>
                                    </div>

                                    <div class="form-group row">

                                        <div class="col-12" style="text-align: right">
                                            <button type="submit" (click)="filterData()" class="btn btn-save">
                                                <i class="fa fa-check" ria-hidden="true"></i> Apply</button>
                                            <button type="submit" (click)="resetFilters()" class="btn btn-save">
                                                <i class="fa fa-check" aria-hidden="true"></i> Reset</button>

                                        </div>
                                    </div>
                                </form>
                            </div>

                        </div>
                           <div class="filter-icon">
                            <button id="dropdownManual" ngbDropdownToggle (click)="openDialog()">
                                <i class="fa fa-filter" aria-hidden="true"></i>
                            </button>
                        </div>

                        <div style="float:right;margin:0px;" class="filter-icon" *ngIf="isFilterApplied"
                            (click)="resetData()">
                            <i class="fa fa-undo" aria-hidden="true"></i>
                        </div>
                    </div> -->

                    <!-- end filter code -->
                    <!-- Main Table Starts here -->
                    <!-- <p>Table</p> -->
                    <p-table #PurchaseOrderListTable dataKey="DraftCode" [rowHover]="true" [filterDelay]="0"
                        [globalFilterFields]="['DraftCode', 'SupplierName']" [columns]="invoicesListCols"
                        [value]="invoicesList" [rows]="1" [scrollable]="true" [scrollHeight]="'calc(100vh - 340px)'"
                        scrollWidth="100%" [virtualRowHeight]="30" [virtualScroll]="true" sortMode="multiple"
                        responsiveLayout="scroll" [rowsPerPageOptions]="[10,25,50,75,100]">
                        <ng-template pTemplate="caption">
                        </ng-template>

                        <ng-template pTemplate="header" let-columns>
                            <tr style="height: 40px;">
                                <th *ngFor="let col of invoicesListCols;let i=index" [pSortableColumn]="col.field">
                                    {{col.header}}
                                    <p-sortIcon [hidden]="i==0" *ngIf="i!=invoicesListCols.length-1"
                                        [field]="col.field"></p-sortIcon>
                                </th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="colgroup" let-columns>
                            <colgroup>
                                <col *ngFor="let col of columns" [style.width]="col.width">
                            </colgroup>
                        </ng-template>
                        <ng-template pTemplate="body" let-value let-columns let-i="rowIndex">
                            <tr style="height:30px" [pSelectableRow]="rowData">
                                <td>{{(value.WorkFlowStatusId != workFlowStatus.Draft &&
                                    value.WorkFlowStatusId != workFlowStatus.CancelDraft ) ?
                                    value.InvoiceCode:value.DraftCode}}
                                </td>
                                <td>{{value.SupplierName}}</td>
                                <!-- <td>{{value.CreatedDate | date: 'yyyy-MM-dd'}}</td> -->
                                <td>{{value.WorkFlowStatusText }}</td>
                                <td class="aligncenter">
                                    <button type="button" class="btn"
                                        (click)="onRecordSelection(value.InvoiceId,value.InvoiceTypeId,value.POTypeId)">
                                        <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                    </button>
                                </td>
                            </tr>

                        </ng-template>
                        <ng-template pTemplate="emptymessage" let-columns>
                            <tr>
                                <td [attr.colspan]="invoicesList.length">
                                    No records found
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                    <div *ngIf="invoicesList.length==0" class="col-12 listErrorMessage">
                        {{errorMessage}}
                    </div>
                    <!-- Main Table Ends Here -->
                    <!-- <div malihu-scrollbar [scrollbarOptions]="scrollbarOptions" class="filter-scroll"
            style="width:100%; float:left;">
            <table class="table">
                <tr>
                    <td (click)="hidefilter()" style="padding: 0px;">
                        <table class="listtable">
                            <tr>
                                <th>Record Name </th>
                              <th>Supplier</th>   
                              <th>Status </th>                            
                            </tr>
                            <tr [class.activerow]="record.InvoiceId==selectedInvoiceDetails.InvoiceId"
                            (click)="onRecordSelection(record.InvoiceId,record.InvoiceTypeId,record.POTypeId)"
                            *ngFor="let record of invoicesList">
                                <td>{{ (record.WorkFlowStatusId != workFlowStatus.Draft &&
                                    record.WorkFlowStatusId != workFlowStatus.CancelDraft ) ?
                                    record.InvoiceCode:record.DraftCode
                                    }}</td>
                                <td>{{ record.SupplierName }}</td>
                                  <td>{{ record.WorkFlowStatusText }}</td> 
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </div> -->

                    <ngb-pagination [maxSize]="5" *ngIf="invoicesList.length>0" (pageChange)="pageChange($event)"
                        [collectionSize]="invoicePagerConfig.TotalRecords" class="d-flex justify-content-center"
                        [pageSize]="invoicePagerConfig.RecordsToFetch" [(page)]="currentPage"
                        [boundaryLinks]="true"></ngb-pagination>

                </div>
            </div>
        </div>
    </div>
</div>


<p-dialog header="Select Invoice Type" width="400" modal='true' [(visible)]="showInvoiceTypeDialog">
    <div class="form-group row">
        <label class="col-form-label col-xl-4 col-sm-6 col-12 form-label">Invoice Type</label>
        <div class="col-xl-8 col-sm-6 col-12">
            <select #purchaseOrderDropDown class="form-control">
                <option value=1>
                    With PO
                </option>
                <option value=2>
                    Without PO
                </option>
            </select>
        </div>
    </div>
    <!-- <div class="form-group row">
        <button style='left:84%;position: relative;' (click)="invoiceSelectionOk(purchaseOrderDropDown.value)"
            class="btn btn-save">
            Ok
        </button>
    </div> -->
</p-dialog>

<!-- <p-dialog [modal]="true" [(visible)]="showVoidPopUp">
    <p-header>
        {{pmoduleHeading}} -->
<!-- Supplier Invoice Void Confirmation -->
<!-- </p-header>
    <div [style.display]="voidPopUpTabId==1?'block':'none'">
        <span>
            {{pmoduleMessage}} -->
<!-- Are you sure to void this Invoice ?? -->
<!-- </span>
    </div>
    <div [style.display]="voidPopUpTabId==3?'block':'none'">
        <span>Document cannot be "Voided" as it is "Exported" or "Paid"</span>
    </div>
    <div [style.display]="voidPopUpTabId==2?'block':'none'">
        <form [formGroup]="invoiceVoidForm">
            <div>
                <label class="form-label">Reasons</label>
                <textarea rows="4" cols="50" class="form-control" formControlName="Reasons">
                    </textarea>
            </div>
            <div *ngIf="invoiceVoidForm.get('Reasons') && invoiceVoidForm.get('Reasons').errors!=null && invoiceVoidForm.get('Reasons').touched==true">
                <span class="errorMessage" *ngIf="invoiceVoidForm.get('Reasons').errors.required">Reasons is Required</span>
            </div>
        </form>
    </div>
    <p-footer>
        <button type="button" *ngIf="isApprovalPage==false&&voidPopUpTabId==2" class="btn" (click)="voidRecord()">Ok</button>
        <button type="button" *ngIf="isApprovalPage==true&&voidPopUpTabId==2" class="btn" (click)="updateRejectStatus(workFlowStatus.Rejected)">Ok</button>
        <button type="button" *ngIf="voidPopUpTabId==3" class="btn" (click)="showVoidPopUp=false">Ok</button>
        <button type="button" *ngIf="voidPopUpTabId==1" class="btn" (click)="voidPopUpTabId=2">Yes</button>
        &nbsp;
        <button type="button" *ngIf="voidPopUpTabId==1" class="btn" (click)="showVoidPopUp=false">No</button>
    </p-footer>
</p-dialog> -->


<ng-template #poTemplate let-r="result" let-i="index" let-t="term">
    <table class="autoCompleteTable" style="width: 99%;">
        <thead *ngIf='r.index==0'>
            <tr>
                <th style="width: 20%">
                    PO Number
                </th>
                <th style="width: 25%">
                    Requestor
                </th>
                <th style="width: 20%">
                    Total
                </th>
                <th style="width: 20%">
                    Date
                </th>
            </tr>
        </thead>
        <tr>
            <td style="width: 20%">{{ r.PurchaseOrderCode }}</td>
            <td style="width: 25%; white-space: pre-wrap; word-wrap: break-word; ">{{ r.FirstName }}</td>
            <td style="width: 20%">{{ r.TotalAmount }}</td>
            <td style="width: 20%">{{ r.CreatedDate |DisplayDateFormat }}</td>
        </tr>
    </table>
</ng-template>

<ng-template #itemMasterTemplate let-r="result" let-t="term">
    <div style="max-height: 100px; overflow: auto">
        {{ r.ItemName }}
    </div>
</ng-template>
<ng-template #itemMasterTemplategl let-r="result" let-t="term">
    <div style="max-height: 100px; overflow: auto">
        {{ r.ItemName }}
    </div>
</ng-template>

<ng-template #serviceMasterTemplate let-r="result" let-t="term">
    <div style="max-height: 100px; overflow: auto">
        {{ r.AccountCodeName }}
    </div>
</ng-template>
<ng-template #ExpenseMasterTemplate let-r="result" let-t="term">
    <div style="max-height: 100px; overflow: auto">
        {{ r.AccountCodeName }}
    </div>
</ng-template>

<ng-template #supplierTemplate let-r="result" let-t="term">
    <!-- {{ r.SupplierName }} -->
    <!-- <div [ngClass]="ngb-disabled">
        <span [ngClass]="{disabled : r.WorkFlowStatus!='Approved'}"> {{ r.WorkFlowStatus!='Approved'? r.SupplierName + " ( " + r.WorkFlowStatus + " ) " : r.SupplierName}}</span>
    </div> -->
    <div [ngClass]="ngb-disabled">
        <span [ngClass]="{disabled : r.WorkFlowStatus!='Approved' || r.IsFreezed===true}">
            {{ r.WorkFlowStatus!='Approved' ? r.SupplierName + " ( " + r.WorkFlowStatus + " ) " :
            r.SupplierName}}</span>
    </div>
</ng-template>
<app-auditlog *ngIf="showLogPopUp" (hideLogPopUp)="hideLogPopUp($event)" [DocumentId]="SelectedInvoiceId"
    [DocumentNumber]="InvoiceCode" [PageName]="'SupplierInvoice'" [DocType]="'Invoice'" [showLogPopUp]="showLogPopUp">
</app-auditlog>